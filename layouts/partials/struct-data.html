{{- if eq .Kind "page" }}
{{- $authorName := "" }}
{{- with $.Site.Params.author }}
{{- with .name }}
{{- $authorName = . }}
{{- end }}
{{- end }}
{{- /* Build a robust image array, preferring background/feature/cover/thumbnail images first */ -}}
{{- $imageUrls := slice }}
{{- $images := .Resources.ByType "image" }}
{{- range slice "*background*" "*feature*" "*cover*" "*thumbnail*" }}
{{- $pattern := . }}
{{- range $images.Match $pattern }}
{{- $imageUrls = $imageUrls | append (.Permalink) }}
{{- end }}
{{- end }}
{{- /* Add remaining images that weren't already matched */ -}}
{{- range $images }}
{{- $url := .Permalink }}
{{- $found := false }}
{{- range $imageUrls }}
{{- if eq . $url }}
{{- $found = true }}
{{- end }}
{{- end }}
{{- if not $found }}
{{- $imageUrls = $imageUrls | append $url }}
{{- end }}
{{- end }}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "{{ .Title | plainify | safeJS }}",
    "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
    "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
    "image": [{{ range $i, $url := $imageUrls }}{{ if $i }}, {{ end }}"{{ $url | safeJS }}"{{ end }}],
    "author": [{
        "@type": "Person",
        "name": "{{ $authorName | safeJS }}",
        "url": "{{ .Site.BaseURL | safeJS }}"
    }]
}
</script>
{{- end }}